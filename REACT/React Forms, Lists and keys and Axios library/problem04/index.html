<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Template</title>
</head>

<body>
    <div id="root"></div>
</body>
<script src="https://www.unpkg.com/react@18.2.0/umd/react.development.js"></script>
<script src="https://www.unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/babel">
    // Your  code will go here


    const { useState, useEffect } = React;

    function App() {
        event.preventDefault()

        const [deta, setdeta] = useState([])
        const [title, settitle] = useState("")
        const [assignee, setassignee] = useState("")
        const [Iscomplete, setIscomplete] = useState(true)
        const [showdata, setshowdata] = useState(false)
        const [updatedata, setUpdate] = useState(false)
        const [updateid, setupdateid] = useState("")
        const [complete, setcomplete] = useState(true)
        const [assigninput, setassigninput] = useState("")

        if (updatedata === true) {
            document.getElementById('section1').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('myinput').focus();

        }


        useEffect(() => {

            async function getdata() {
                try {
                    const res = await axios.get("http://localhost:3000/tasks")

                    setdeta(res.data)

                } catch (error) {
                    console.log(error)
                }
            }

            getdata()



        }, [])




        //      post data from API

        const btn = () => {
            if (title !== "" && assignee !== "" && Iscomplete !== null) {
                if (!updatedata) {


                    const new_post = {

                        "title": title,
                        "isCompleted": Iscomplete,
                        "assignee": assignee
                    }
                    post_data(new_post)
                    document.getElementsByClassName("inp").value = "";
                    settitle("")
                    alert("your task is added")


                } else {

                    const update_data = {

                        "title": title,
                        "isCompleted": Iscomplete,
                        "assignee": assignee

                    }

                    callfn(update_data)
                    document.getElementsByClassName("inp").value = "";
                    settitle("")
                    alert("your task is added")

                    setUpdate(false)


                }
            }
            else {
                alert("please fill all input")
            }


        }



        async function post_data(new_post) {
            try {
                const post = axios.post('http://localhost:3000/tasks', new_post)
            } catch (error) {
                console.log(error)
            }
        }

        //  delete data from API

        const delete_btn = async (id) => {



            try {
                const resdata = await axios.delete(`http://localhost:3000/tasks/${id}`)
                setdeta(resdata)
                console.log(resdata)

            } catch (error) {
                console.log(error)
            }




        }




        async function callfn(update_data) {

            try {
                const response = await axios.put(`http://localhost:3000/tasks/${updateid}`, update_data)
                console.log(response)

            } catch (error) {
                console.log(error)
            }
        }




        const flter = deta.filter((ele => complete === true ? complete : ele.isCompleted === complete))

        const assigneefilter = flter.filter((current) => current.assignee.toLowerCase().includes(assigninput))


        return (
            <>
                <section id="section1" style={style.section}>
                    <h1>{updatedata ? `Update Data Id: ${updateid}` : "Add New Task"}</h1>
                    <input style={style.input} className="inp" id="myinput" type="text" placeholder={updatedata ? "Enter Update Title" : "Enter Title"} onChange={(e) => settitle(e.target.value)} />
                    <input style={style.input} className="inp" type="text" placeholder={updatedata ? "Enter Update Name For Assignee" : "Enter Name For Assignee"} onChange={(e) => setassignee(e.target.value)} />
                    <div>
                        <select style={style.input} name="Iscomplete" value="true" id="" onChange={(e) => setIscomplete(e.target.value)}>
                            <option value="True">True</option>
                            <option value="False">False</option>
                        </select>
                        <button style={style.input} onClick={btn}>{updatedata ? "Update" : "Add Task"}</button>
                    </div>
                </section>

                <section style={style.section2}>
                    <button onClick={() => setshowdata(!showdata)}>Show all</button>
                    <button onClick={() => setcomplete(!complete)}>Show incompleted</button>
                    <div>{showdata &&
                        <input type="text" placeholder="Filter By Assignee Name" onChange={(e) => setassigninput(e.target.value)} />
                    }</div>

                    <div style={style.showdata} >{showdata && assigneefilter.map((datas, index) => <ul style={style.mini_container} key={index}>
                        <h3>{datas.title}</h3>
                        <p>Is completed:-  {datas.isCompleted.toString()}</p>
                        <p>Assignee:- {datas.assignee}</p>

                        <button onClick={() => { setupdateid(datas.id), setUpdate(!updatedata) }}>Update</button>
                        <button onClick={() => delete_btn(datas.id)}>‚ùåDelete</button>
                    </ul>)}
                    </div>
                </section>
            </>
        )
    }


    ReactDOM.createRoot(document.getElementById("root")).render(<App />)

    const style = {
        section: {
            border: "1px solid",
            display: "flex",
            flexDirection: "column",
            width: "50%",
            margin: "auto",
            textAlign: "center",
            padding: "30px",
            gap: "20px"

        },
        input: {
            padding: "10px"

        },
        section2: {
            // border: "1px solid",
            display: "flex",
            flexDirection: "column",
            width: "50%",
            margin: "auto",
            padding: "30px",
            gap: "10px"
        },
        showdata:{
            display:"grid",
            gridTemplateColumns:"repeat(3, 1fr)",
            gap: "10px"
         
        },
        mini_container:{
            border:"1px solid",
            padding:"10px"
            
        }
    }


</script>

</html>