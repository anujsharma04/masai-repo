<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather App</title>
</head>

<body>
    <div id="root"></div> <!-- React app yaha render hoga -->
</body>

<!-- Load React, ReactDOM, Babel, Axios -->
<script src="https://www.unpkg.com/react@18.2.0/umd/react.development.js"></script>
<script src="https://www.unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<!-- Babel script for writing JSX directly -->
<script type="text/babel">

// Import React hooks
const { useState, useEffect } = React;

function App() {
    // States for different data
    const [inputText, setInputText] = useState("");         // For input field (city name)
    const [weatherData, setWeatherData] = useState(null);    // Current weather data
    const [forecastData, setForecastData] = useState([]);    // 5-day forecast data
    const [favorites, setFavorites] = useState([]);          // List of favorite cities
    const [loading, setLoading] = useState(false);           // Loading state for API calls
    const [error, setError] = useState("");                  // Error message state

    const API_KEY = "f42de56fd2b9c25d79d3166b3b85bfc9"; // OpenWeather API key

    // Function to fetch current weather by city name
    async function fetchWeather(city) {
        try {
            setLoading(true);  // Show loading
            setError("");      // Clear previous error
            const res = await axios.get(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric`);
            // Save weather data
            setWeatherData({
                temp: res.data.main.temp,
                humidity: res.data.main.humidity,
                wind: res.data.wind.speed,
                description: res.data.weather[0].description,
                city: res.data.name
            });
        } catch (err) {
            console.error(err);
            setError("City not found. Please try again!");  // Show error if city not found
            setWeatherData(null);
            setForecastData([]);
        } finally {
            setLoading(false); // Hide loading
        }
    }

    // Function to fetch 5-day forecast
    async function fetchForecast(city) {
        try {
            const res = await axios.get(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${API_KEY}&units=metric`);
            // Filter forecast data to daily (12 PM data)
            const dailyData = res.data.list.filter(item => item.dt_txt.includes("12:00:00"));
            setForecastData(dailyData);
        } catch (err) {
            console.error(err);
        }
    }

    // Function called when search button clicked
    const handleSearch = () => {
        if (inputText.trim() !== "") {
            fetchWeather(inputText);  // Get current weather
            fetchForecast(inputText); // Get forecast
        }
    };

    // Add city to favorites list
    const handleAddFavorite = () => {
        if (weatherData && !favorites.includes(weatherData.city)) {
            setFavorites(prev => [...prev, weatherData.city]);
        } else {
            alert("Already in favorites!");
        }
    };

    // Click on favorite city to fetch its weather
    const handleFavClick = (city) => {
        fetchWeather(city);
        fetchForecast(city);
    };

    // Actual UI rendering
    return (
        <>
            {/* Navbar Section */}
            <nav style={styles.nav}>
                <h1>üå¶Ô∏è Weather App</h1>
                <div style={styles.searchBox}>
                    <input
                        style={styles.input}
                        type="text"
                        placeholder="Enter city name"
                        onChange={(e) => setInputText(e.target.value)}
                    />
                    <button style={styles.button} onClick={handleSearch}>Search</button>
                </div>
                <button style={styles.button} onClick={handleAddFavorite}>Add Favorite</button>
            </nav>

            {/* Main Section */}
            <section style={{ padding: "20px" }}>
                {/* Show loading */}
                {loading && <h2>Loading...</h2>}

                {/* Show error */}
                {error && <h2 style={{ color: "red" }}>{error}</h2>}

                {/* If weather data available, show weather info */}
                {weatherData && (
                    <>
                        <div style={styles.weatherBox}>
                            <div>
                                <h2>{weatherData.city}</h2>
                                <p><strong>Temperature:</strong> {weatherData.temp}¬∞C</p>
                                <p><strong>Humidity:</strong> {weatherData.humidity}%</p>
                                <p><strong>Wind:</strong> {weatherData.wind} km/h</p>
                                <p><strong>Description:</strong> {weatherData.description}</p>
                            </div>
                        </div>

                        {/* Show forecast table */}
                        <h2 style={{ marginTop: "30px" }}>5 Day Forecast</h2>
                        <table style={styles.table}>
                            <thead style={styles.thead}>
                                <tr>
                                    <td>Date</td>
                                    <td>Temp</td>
                                    <td>Humidity</td>
                                    <td>Wind</td>
                                    <td>Description</td>
                                </tr>
                            </thead>
                            <tbody>
                                {forecastData.map((item, index) => (
                                    <tr key={index}>
                                        <td>{item.dt_txt.split(" ")[0]}</td>
                                        <td>{item.main.temp}¬∞C</td>
                                        <td>{item.main.humidity}%</td>
                                        <td>{item.wind.speed} km/h</td>
                                        <td>{item.weather[0].description}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>

                        {/* Show favorite cities */}
                        {favorites.length > 0 && (
                            <>
                                <h2 style={{ marginTop: "30px" }}>Favorite Cities</h2>
                                <div style={styles.favoriteBox}>
                                    {favorites.map((city, idx) => (
                                        <button
                                            key={idx}
                                            style={styles.favButton}
                                            onClick={() => handleFavClick(city)}
                                        >
                                            {city}
                                        </button>
                                    ))}
                                </div>
                            </>
                        )}
                    </>
                )}
            </section>
        </>
    );
}

// Inline CSS styling object
const styles = {
    nav: {
        display: "flex",
        justifyContent: "space-around",
        alignItems: "center",
        padding: "10px",
        backgroundColor: "#90e0ef"
    },
    searchBox: {
        display: "flex",
        gap: "10px",
    },
    input: {
        padding: "10px",
        borderRadius: "8px",
        border: "1px solid #333",
        outline: "none"
    },
    button: {
        padding: "10px",
        borderRadius: "8px",
        border: "none",
        backgroundColor: "#00b4d8",
        color: "white",
        cursor: "pointer"
    },
    weatherBox: {
        marginTop: "20px",
        padding: "20px",
        border: "1px solid #333",
        borderRadius: "10px",
        width: "300px",
        margin: "auto",
        textAlign: "center",
    },
    table: {
        width: "80%",
        margin: "20px auto",
        borderCollapse: "collapse"
    },
    thead: {
        backgroundColor: "#caf0f8"
    },
    favoriteBox: {
        display: "flex",
        flexWrap: "wrap",
        gap: "10px",
        justifyContent: "center",
        marginTop: "10px"
    },
    favButton: {
        padding: "8px 15px",
        backgroundColor: "#0077b6",
        color: "white",
        border: "none",
        borderRadius: "8px",
        cursor: "pointer"
    }
};

// Render the App component into the root div
ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>

</html>
